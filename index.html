<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HappyOrNot</title>
    <style>
        canvas,
        video {
            position: absolute;
            margin-left: 30%;
            margin-right: 30%;
            top: 20%;
        }
        video {
            border: solid 4px rgb(43, 43, 43);
        }
        body {
            background-color: black;
        }
        
    </style>
</head>

<body onload="init()">

    <a href="https://github.com/justadudewhohacks/face-api.js">The AI</a>
    <a href="https://github.com/WebDevSimplified/Face-Detection-JavaScript/tree/master/models">Models</a>
    <video id="video" width="1024" height="768" autoplay muted>
    <script src="face-api.min.js"></script>
    <script>
        async function init() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
            await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
            await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
            await faceapi.nets.faceExpressionNet.loadFromUri('/models');
            navigator.getUserMedia({
                video: {}
            },
            s => video.srcObject = s,
            console.error);
        }

        video.addEventListener('play', startFaceDetection)

        function startFaceDetection(){
            let canvas = faceapi.createCanvasFromMedia(video);
            document.body.append(canvas);
            setInterval(async function(){
                let options = new faceapi.TinyFaceDetectorOptions();
                canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
                let size = {width: video.width, height: video.height};
                let detections = await faceapi.detectAllFaces(video, options).withFaceLandmarks().withFaceExpressions();
                let resizedDetections = faceapi.resizeResults(detections, size);
                faceapi.draw.drawDetections(canvas, resizedDetections);
                faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);
                faceapi.draw.drawFaceExpressions(canvas, resizedDetections);
            }, 100);
        }
    </script>
</body>

</html>